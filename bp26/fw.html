<html>

<head>
  <title>‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£‡§Æ‡•ç</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="css/find.css" />
      <!-- Header CSS -->
    <link rel="stylesheet" href="css/header.css" />
  <script type="text/javascript" src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <style>
    /* The switch - the box around the slider */
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    /* Hide default HTML checkbox */
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    /* The slider */
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }

    input:checked+.slider {
      background-color: #2196F3;
    }

    input:focus+.slider {
      box-shadow: 0 0 1px #2196F3;
    }

    input:checked+.slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
      border-radius: 34px;
    }

    .slider.round:before {
      border-radius: 50%;
    }

    /* ‚úÖ Celebration UI (inline) */
    #bp26CelebrateOverlay{
      position: fixed; inset: 0;
      display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.35);
      z-index: 10000;
      padding: 20px;
      border: none;
    }
    .bp26CelebrateBox{
      position: relative;
      width: min(460px, 92vw);
      background: #fff;
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.25);
      text-align: center;
      font-family: system-ui, Arial, sans-serif;
      border: 1px solid #eee;
    }
    .bp26Sparkles{
      font-size: 54px;
      line-height: 1.1;
      margin: 8px 0 6px;
      animation: bp26Pop 600ms ease-out both;
    }
    @keyframes bp26Pop{
      0%{ transform: scale(0.6); opacity: 0; }
      100%{ transform: scale(1); opacity: 1; }
    }
    .bp26Btn{
      margin-top: 12px; padding: 10px 14px;
      border-radius: 12px; border: 1px solid #ddd;
      background: #f9fafb; cursor: pointer;
    }
    .bp26Confetti{
      position: fixed;
      top: -12px;
      width: 10px; height: 10px;
      border-radius: 3px;
      z-index: 10001;
      opacity: .95;
      animation: bp26Fall 950ms linear forwards;
      pointer-events: none;
    }
    @keyframes bp26Fall{
      to{ transform: translateY(110vh) rotate(540deg); opacity: 0.9; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@sanskrit-coders/sanscript@1.1.0/sanscript.min.js"></script>
</head>

<body>
      <!-- Header Placeholder -->
    <div id="header-placeholder"></div>

  <script type="module" src="../js/bilingual-toggle.js"></script>

      <!-- Load Header -->
    <script src="js/load-header.js"></script>

        <style>
      body {
        padding-top: 7%;
      }
    </style>
  <h1 class="gameTitle">Word Search </h1>
  <div class="header-divider"></div>
  <div id="lead">‡§Ö‡§∏‡•ç‡§Æ‡§ø‡§®‡•ç ‡§Ö‡§ï‡•ç‡§∑‡§∞‡§∏‡§Æ‡•Ç‡§π‡•á ‡§Ö‡§¶‡•ç‡§Ø‡§§‡§®-‡§ï‡§•‡§æ-‡§§‡§É ‡§™‡§¶‡§æ‡§®‡§ø ‡§∏‡§®‡•ç‡§§‡§ø ‡•§ ‡§ï‡§§‡§ø ? <span style="font-weight:bold"
      id="nPresent">‡•´</span> ‡•§ ‡§ï‡§∞‡•ã‡§§‡•Å ‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£‡§Æ‡•ç ‡•§ <br><span id="lead2"></span> </div>
  <div id="statusMessage"> ‡§™‡§¶‡§æ‡§®‡§ø ‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§ø‡§§‡§æ‡§®‡§ø</div>
  <div id="liveScore" style="
    text-align:center;
    font-weight:bold;
    margin:6px 0;
    font-size:18px;
  ">
    Score: 100
  </div>
  <div id="finishMessage">‡•§‡•§ ‡§∂‡•Å‡§≠‡§Æ‡§∏‡•ç‡§§‡•Å ‡•§‡•§ </div>
  <div id="gridParent">
    <div id="grid"></div>

  </div>

  <div id="level">
    <div class="leveltext">
      ‚úîÔ∏è = <span id="nFound"></span>
      <br>
      <strong>‡§ï‡§†‡§ø‡§®‡§§‡§æ</strong>
      <ul>
        <li><a href="fw.html?size=5" onclick="sV(this)">‡§∏‡§∞‡§≤‡§Æ‡•ç </a></li>
        <li><a href="fw.html?size=7" onclick="sV(this)">‡§Æ‡§ß‡•ç‡§Ø‡§Æ‡§Æ‡•ç </a></li>
        <li><a href="fw.html?size=10" onclick="sV(this)">‡§ï‡§†‡§ø‡§®‡§Æ‡•ç </a></li>
      </ul>



    </div>
  </div>
  </div>
  <div id="hintLink">
    <div>
      <a onclick="showHint1()" href="#"><img src="imgs/hint.png" alt="help">‡§®‡§æ‡§Æ‡§™‡§¶‡§æ‡§®‡§ø ..</a>
      <a onclick="showHint2()" href="#"><img src="imgs/hint2.png" alt="help">.. ‡§ï‡§æ‡§®‡§ø ??? </a>
    </div>

    <div id="hintPopup" onclick="hideHint()">
      <div class="content" onclick="hideHint()">
        <ul id="answers">
        </ul>
      </div>
    </div>

  </div>

  <div id="refreshLink">
    <div><a href="#" onclick="window.location.reload(); return false;"><img src="imgs/refresh.png" alt="re-do">
        <div>‡§™‡•Å‡§®‡§É</div>
      </a>
    </div>
  </div>

  <!-- ‚úÖ Celebration overlay (inline) -->
  <div id="bp26CelebrateOverlay">
    <div class="bp26CelebrateBox">
      <div class="bp26Sparkles">‚ú®üéâ‚ú®</div>
      <div id="bp26CelebrateTitle" style="font-weight:700;font-size:18px;margin-bottom:6px;">
        Submitted ‚úÖ
      </div>
      <div id="bp26CelebrateSub" style="font-size:14px;color:#374151;">
        Nice work!
      </div>
      <button id="bp26CelebrateClose" class="bp26Btn">Close</button>
    </div>
  </div>

  <script>
    /* ---------------------------
       Celebration (inline)
    --------------------------- */
    function bp26Celebrate({ title="Submitted ‚úÖ", subtitle="Nice work!", score=null } = {}) {
      const overlay = document.getElementById("bp26CelebrateOverlay");
      const t = document.getElementById("bp26CelebrateTitle");
      const s = document.getElementById("bp26CelebrateSub");

      t.textContent = title;
      s.textContent = score === null ? subtitle : `${subtitle}  Score: ${score} ‚ú®`;

      overlay.style.display = "flex";
      bp26BurstConfetti(70);

      setTimeout(() => { overlay.style.display = "none"; }, 2200);
    }

    function bp26BurstConfetti(count=60) {
      for (let i = 0; i < count; i++) {
        const c = document.createElement("div");
        c.className = "bp26Confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.width = (6 + Math.random() * 8) + "px";
        c.style.height = (6 + Math.random() * 8) + "px";
        c.style.background = `hsl(${Math.floor(Math.random() * 360)}, 90%, 60%)`;
        c.style.transform = `translateY(0) rotate(${Math.random() * 180}deg)`;
        c.style.animationDuration = (800 + Math.random() * 600) + "ms";
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 1600);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const closeBtn = document.getElementById("bp26CelebrateClose");
      const overlay = document.getElementById("bp26CelebrateOverlay");
      if (closeBtn) closeBtn.addEventListener("click", () => overlay.style.display = "none");
      if (overlay) overlay.addEventListener("click", (e) => {
        if (e.target === overlay) overlay.style.display = "none";
      });
    });
  </script>

  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
  <script>
    const BP26_GAME = "bp26-Game4";
    const BP26_DAY = 4;
    var wpp = 15;
    var answers = [];
    var wlist = [];
    var N_ROWS = 10;
    var N_COLS = 10;
    var nc = 0;
    var N_WORDS_TO_FIND = 5;
    var isGameFinished = false;
    let score = 0;
    let scoreInterval = null;
    const liveScoreEl = document.getElementById("liveScore");
    const urlParams = new URLSearchParams(window.location.search);
    var data = urlParams.get('d');
    if (!data)
      data = "‡§Ö‡§ï‡•ç‡§∑‡§∞‡§∏‡§Æ‡•Ç‡§π‡•á ‡§Ö‡§¶‡•ç‡§Ø‡§§‡§®-‡§ï‡§•‡§æ ‡§™‡§¶‡§æ‡§®‡§ø ‡§∏‡§®‡•ç‡§§‡§ø ‡§ï‡§∞‡•ã‡§§‡•Å ‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£‡§Æ‡•ç";

  // Bilingual support: read transliteration target from `t` param
  // (e.g., t=gu, t=ka). When missing or unsupported, fall back to
  // IAST for tooltips/overlays.
  var t = urlParams.get('t');
  if (!t) t = 0;
  var tlang = [];
  tlang[1] = "itrans";
  tlang['gu'] = "gujarati";
  tlang['ka'] = "kannada";
  tlang['be'] = "bengali";
  tlang['ml'] = "malayalam";
  tlang['te'] = "telugu";
  tlang['ta'] = "tamil";

  var wordList = Sanscript.t(data, 'iast', 'devanagari').split(" ");
    document.addEventListener('DOMContentLoaded', function () {
      //	timer = setInterval('countSecs("timer")',1000); //1000ms to wait before executing the code =1 second  
      //       countSecs("timer");

      var lnk = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6CFR_0gDsZl-lmwLFWmtdXMXYGVEHGJ8fvBu2_5wvbEl9L-4Yr0ugI0TFTTdvtLlMTRmLnCIJ5FBF/pub?gid=0&single=true&output=csv";
      Papa.parse(lnk, {
        download: true,
        header: true,
        complete: populateWlist
      })
    })
    function populateWlist(fildat) {
      var set = urlParams.get('set');
      if (!set || isNaN(set))
        set = 0;
      fullist = fildat.data;
      if (set > fildat.data.length / wpp) set = 0;

      for (i = 0; i < wpp; i++) {
        wlist.push(fullist[(set * wpp) + i].padam);
      }

      if (wlist.length > 0)
        wordList = wlist;

      N_WORDS_TO_FIND = Math.min(N_WORDS_TO_FIND, wordList.length);
      var size = urlParams.get('size');;
      if (size && size >= 4 && size <= 15) {
        N_ROWS = size;
        N_COLS = size;
        N_WORDS_TO_FIND = Math.min(Math.floor(size / 2), wordList.length);
      }
      var MAX_MARKER_IDX = 6;

      function initScoreByDifficulty() {
        const size = urlParams.get('size');
        if (size == 10) {   
          score = 200; // hard 
        } 
        else if (size == 7) {  
          score = 100; // medium
        }
        else if (size == 5){
          score = 50; // easy 
        }
        else {
          score = 200; // fallback
        }

        // show starting score
        liveScoreEl.textContent = "Score: " + Math.round(score);

        // time decay: -0.6 per second
        scoreInterval = setInterval(() => {
          score -= 0.6; 
          if (score < 0) score = 0;

          liveScoreEl.textContent = "Score: " + Math.round(score);
        }, 1000);
      }

      var main = function () {
        drawGrid();
        var nWordsPut = 0;
        do {
          var words = getWordsToFind();
          nWordsPut = putWords(words);
        } while (nWordsPut == 0);
        fillRandom();
        countAnswers();
        hideHint();
        resizeGrid();
        registerEventListeners();
      };
      var registerEventListeners = function () {
        $("#grid").on("selectstart", function (e) {
          return false;
        });
        $("#grid td").bind("click", cellClick);
      };
      var drawGrid = function () {
        var table = $("<table></table>");
        var rowIdx = 0;
        var colIdx = 0;
        for (rowIdx = 0; rowIdx < N_ROWS; rowIdx++) {
          var row = $('<tr id="tblRow_"' + rowIdx + '"></tr>');
          for (colIdx = 0; colIdx < N_COLS; colIdx++) {
            var cell = $('<td id="tblCell_' + rowIdx + "_" + colIdx + '"></td>');
            row.append(cell);
          }
          table.append(row);
        }
        $("#grid").append(table);
      };
      var foundStrings = {}; /* key: cell id. value: a dict of 'match entries' for strings found that pass involve this cell */
      var stringToCss = {}; /*key: string that was found. value: a css class name for it*/
      var nAnswersPresent = 0;
      var nAnswersDiscovered = 0;

      var countAnswers = function () {
        var rowIdx = 0;
        var colIdx = 0;
        for (rowIdx = 0; rowIdx < N_ROWS; rowIdx++) {
          for (colIdx = 0; colIdx < N_COLS; colIdx++) {
            var matches = processCell(
              $("#tblCell_" + rowIdx + "_" + colIdx).get(0),
              true
            );
            answers = answers.concat(matches);
            nAnswersPresent += matches.length;
          }
        }
        $("#finishMessage").hide();
        $("#nPresent").text(String.fromCharCode(0x0966 + nAnswersPresent));
        $("#nFound").text(0);
        var answerIdx = 0;
        for (answerIdx = 0; answerIdx < answers.length; answerIdx++) {
          $("#answers").append("<li>" + answers[answerIdx] + "</li>");
        }
      };

      var cellClick = async function (e) {
        // prevent double submission
        if (isGameFinished) return;

        nc++;
        // lose points for wrong clicks
        score -= 1;
        if (score < 0) score = 0;

        var cell = $(e.target).closest("td").get(0);
        const foundNow = processCell(cell).length;
        nAnswersDiscovered += foundNow;

        // gain points when you actually find words
        if (foundNow > 0) {
          score += foundNow * 10;
        }     
        liveScoreEl.textContent = "Score: " + Math.round(score);

        $("#nFound").text(String.fromCharCode(0x0966 + nAnswersDiscovered));

        if (nAnswersDiscovered == nAnswersPresent) {
          isGameFinished = true;
          clearInterval(scoreInterval);
          const finalScore = Math.round(score);
          liveScoreEl.textContent = "Final Score: " + finalScore;

          // ‚úÖ submit the actual game score
          let submitOk = true;
          try {
            if (window.reportScore) {
              await window.reportScore(finalScore); // ‚úÖ send correct score
            }
          } catch (err) {
            submitOk = false;
            console.error("Score submit failed:", err);
          }

          // ‚úÖ show celebration first (no alert/confirm to block it)
          bp26Celebrate({
            title: submitOk ? "Score Submitted ‚úÖ" : "Finished ‚úÖ",
            subtitle: submitOk ? "Great job!" : "Saved locally (Firebase not ready)",
            score: finalScore
          });

          $("#finishMessage").append("<br>AFTER " + nc + " clicks!");
          $("#finishMessage").show();
          $("#statusMessage").hide();
          $("#lead").hide();
        }
      };
      var processCell = function (cell, doNotMark) {
        if ($(cell).hasClass("found")) {
          //showDetails(cell.id);
          return [];
        }
        var cellRowIdx = parseInt(cell.id.split("_")[1]);
        var cellColIdx = parseInt(cell.id.split("_")[2]);
        var matches = [];

        //check if there are any horizontal matches
        var rowIdx = 0;
        var colIdx = 0;
        var matchCandidate = "";
        for (colIdx = cellColIdx; colIdx < N_COLS; colIdx++) {
          matchCandidate =
            matchCandidate + $("#tblCell_" + cellRowIdx + "_" + colIdx).text();
          if (isProperMatch(matchCandidate)) {
            matches.push(matchCandidate);
            if (doNotMark) {
              continue;
            }
            markMatch(cellRowIdx, cellColIdx, cellRowIdx, colIdx, matchCandidate);
          }
        }
        //check if there are any vertical matches
        matchCandidate = "";
        rowIdx = 0;
        colIdx = 0;
        for (rowIdx = cellRowIdx; rowIdx < N_ROWS; rowIdx++) {
          matchCandidate =
            matchCandidate + $("#tblCell_" + rowIdx + "_" + cellColIdx).text();
          if (
            convertToArrayOfAksharas(matchCandidate).length > 1 &&
            isProperMatch(matchCandidate)
          ) {
            matches.push(matchCandidate);
            if (doNotMark) {
              continue;
            }
            markMatch(cellRowIdx, cellColIdx, rowIdx, cellColIdx, matchCandidate);
          }
        }
        //check if there are any diagonal matches
        matchCandidate = "";
        rowIdx = 0;
        colIdx = 0;
        for (
          diagIdx = 0;
          diagIdx + cellRowIdx < N_ROWS && diagIdx + cellColIdx < N_COLS;
          diagIdx++
        ) {
          matchCandidate =
            matchCandidate +
            $(
              "#tblCell_" + (diagIdx + cellRowIdx) + "_" + (diagIdx + cellColIdx)
            ).text();
          if (
            convertToArrayOfAksharas(matchCandidate).length > 1 &&
            isProperMatch(matchCandidate)
          ) {
            matches.push(matchCandidate);
            if (doNotMark) {
              continue;
            }
            markMatch(
              cellRowIdx,
              cellColIdx,
              diagIdx + cellRowIdx,
              diagIdx + cellColIdx,
              matchCandidate
            );
          }
        }
        return matches;
      };

      var markMatch = function (
        startRowIdx,
        startColIdx,
        endRowIdx,
        endColIdx,
        word
      ) {
        if (!stringToCss[word]) {
          var nCssUsed = Object.keys(stringToCss).length;
          if (nCssUsed > MAX_MARKER_IDX) {
            stringToCss[word] = "markerX";
          } else {
            stringToCss[word] = "marker" + Object.keys(stringToCss).length;
          }
        }
        $("#tblCell_" + startRowIdx + "_" + startColIdx).addClass("found");
        if (startRowIdx == endRowIdx) {
          var colIdx;
          for (colIdx = startColIdx; colIdx <= endColIdx; colIdx++) {
            var cellId = "tblCell_" + startRowIdx + "_" + colIdx;
            markCell(cellId, word);
          }
          return;
        }
        if (startColIdx == endColIdx) {
          var rowIdx;
          for (rowIdx = startRowIdx; rowIdx <= endRowIdx; rowIdx++) {
            var cellId = "tblCell_" + rowIdx + "_" + startColIdx;
            markCell(cellId, word);
          }
          return;
        }
        var cellIdx = 0;
        for (cellIdx = 0; cellIdx < endColIdx - startColIdx + 1; cellIdx++) {
          var cellId =
            "tblCell_" + (startRowIdx + cellIdx) + "_" + (startColIdx + cellIdx);
          markCell(cellId, word);
        }
      };
      var markCell = function (cellId, word) {
        if (!foundStrings[cellId]) {
          foundStrings[cellId] = {};
          var markersDiv = $("#" + cellId).append('<div class="markers"></div>');
        }
        if (!foundStrings[cellId][word]) {
          foundStrings[cellId][word] = {}; //TODO: is anything needed to be stored in this object?
        }
        $("#" + cellId + " .markers").append(
          $("<div class='marker'></div>").addClass(stringToCss[word])
        );
      };
      var isProperMatch = function (candidate) {
        var wordListIdx = 0;
        for (wordListIdx = 0; wordListIdx < wordList.length; wordListIdx++) {
          if (wordList[wordListIdx] === candidate) {
            return true;
          }
        }
        return false;
      };

      var showDetails = function (cellId) {
        //console.log("show details for " + cellId);
      };

      var showHint = function () {
        $("#hintPopup").show();
        return false;
      };
      var hideHint = function () {
        $("#hintPopup").hide();
      };
      var getWordsToFind = function () {
        var indices = [];
        var i = 0;
        for (i = 0; i < wordList.length; i++) {
          indices.push(i);
        }
        // shuffle the array of indices
        for (i = indices.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var tmp = indices[i];
          indices[i] = indices[j];
          indices[j] = tmp;
        }
        var wordsToFind = [];
        for (i = 0; i < N_WORDS_TO_FIND; i++) {
          wordsToFind.push(wordList[indices[i]]);
        }
        return wordsToFind;
      };
      /**
       * Puts the given words into the grid randomly
       * @param {*} words - Words to put into the grid
       */
      var putWords = function (words) {
        var wordsIdx = 0;
        var nWordsPut = 0;
        for (wordsIdx = 0; wordsIdx < words.length; wordsIdx++) {
          if (putWord(words[wordsIdx])) {
            nWordsPut++;
          }
        }
        return nWordsPut;
      };
      /**
       * Puts the given word into the grid at a random location
       * @param {*} strWord - Word to place into the grid
       */
      var putWord = function (strWord) {
        var word = convertToArrayOfAksharas(strWord);
        var emptySlots = findEmptySlots();
        var attemptedSlots = [];
        while (attemptedSlots.length < emptySlots.length) {
          // Compute which slots haven't been attempted
          var remainingSlots = [];
          remainingSlots = remainingSlots.concat(emptySlots);
          var remainingSlotIdx = remainingSlots.length;
          while (remainingSlotIdx--) {
            if (attemptedSlots.indexOf(remainingSlots[remainingSlotIdx]) >= 0) {
              remainingSlots.splice(remainingSlotIdx, 1);
            }
          }

          // Find a random slot to attempt
          var slot =
            remainingSlots[Math.floor(Math.random() * remainingSlots.length)];
          attemptedSlots.push(slot);

          var slotRowIdx = parseInt(slot.split("_")[1]);
          var slotColIdx = parseInt(slot.split("_")[2]);

          var directionsRemaining = ["H", "V", "D"]; //horizontal, vertical, diagonal
          nextDirection: while (directionsRemaining.length > 0) {
            var direction =
              directionsRemaining[
              Math.floor(Math.random() * directionsRemaining.length)
              ];
            directionsRemaining.splice(directionsRemaining.indexOf(direction), 1);
            var rowIdx = 0;
            var colIdx = 0;
            var wordIdx = 0;
            //check if this word can be placed in the direction specified
            for (wordIdx = 0; wordIdx < word.length; wordIdx++) {
              var charToPut = word[wordIdx];
              var targetCell = undefined;
              switch (direction) {
                case "H":
                  targetCell =
                    "#tblCell_" + slotRowIdx + "_" + (slotColIdx + wordIdx);
                  break;
                case "V":
                  targetCell =
                    "#tblCell_" + (slotRowIdx + wordIdx) + "_" + slotColIdx;
                  break;
                case "D":
                  targetCell =
                    "#tblCell_" +
                    (slotRowIdx + wordIdx) +
                    "_" +
                    (slotColIdx + wordIdx);
                default:
              }
              if ($(targetCell).length == 0) {
                // target cell is out of the grid boundaries
                break nextDirection;
              }
              if ($(targetCell).text().trim().length == 0) {
                continue;
              }
              if ($(targetCell).text().trim() != charToPut) {
                // there is a conflicting character at the target cell
                break nextDirection;
              }
            }
            //place the word
            for (wordIdx = 0; wordIdx < word.length; wordIdx++) {
              var charToPut = word[wordIdx];
              var targetCell = undefined;
              switch (direction) {
                case "H":
                  targetCell =
                    "#tblCell_" + slotRowIdx + "_" + (slotColIdx + wordIdx);
                  break;
                case "V":
                  targetCell =
                    "#tblCell_" + (slotRowIdx + wordIdx) + "_" + slotColIdx;
                  break;
                case "D":
                  targetCell =
                    "#tblCell_" +
                    (slotRowIdx + wordIdx) +
                    "_" +
                    (slotColIdx + wordIdx);
                default:
              }
              var ttChar = (t && tlang[t])
                ? Sanscript.t(String(charToPut), 'devanagari', tlang[t])
                : Sanscript.t(String(charToPut), 'devanagari', 'iast');
              $(targetCell).html("<span title='" + ttChar + "'>" + charToPut + "</span>");
            }
            //placed the word
            return true;
          }
        }
        //the word could not be placed
        return false;
      };
      var convertToArrayOfAksharas = function (strWord) {
        var aksharas = [];
        var currentAkshara = "";
        var charIdx = 0;
        for (charIdx = 0; charIdx < strWord.length; charIdx++) {
          var char = strWord[charIdx];
          if (fullSwaras.indexOf(char) >= 0) {
            currentAkshara = currentAkshara + char;
            /*if(currentAkshara.length>0){
                      aksharas.push(currentAkshara);
                      currentAkshara = '';
                  }
                  aksharas.push(char);
                  */
            continue;
          }
          if (anuswara == char || visarga == char) {
            currentAkshara = currentAkshara + char;
            aksharas.push(currentAkshara);
            currentAkshara = "";
            continue;
          }
          if (swaras.indexOf(char) >= 0) {
            currentAkshara = currentAkshara + char;
            //aksharas.push(currentAkshara)
            //currentAkshara = '';
            continue;
          }
          if (halant == char) {
            currentAkshara = currentAkshara + char;
            continue;
          }
          if (vyanjanas.indexOf(char) >= 0) {
            if (
              currentAkshara.length > 0 &&
              halant != currentAkshara[currentAkshara.length - 1]
            ) {
              aksharas.push(currentAkshara);
              currentAkshara = "";
            }
            currentAkshara = currentAkshara + char;
            continue;
          }
          if (currentAkshara.length > 0) {
            aksharas.push(currentAkshara);
            currentAkshara = "";
          }
          aksharas.push(char);
        }
        if (currentAkshara.length > 0) {
          aksharas.push(currentAkshara);
        }
        return aksharas;
      };
      var findEmptySlots = function () {
        var emptySlots = [];
        $("#grid td").each(function (idx, cell) {
          if ($(cell).text().trim().length == 0) {
            emptySlots.push($(cell).attr("id"));
          }
        });
        return emptySlots;
      };
      var fillRandom = function () {
        $("#grid td").each(function (idx, cell) {
          if ($(cell).text().trim().length == 0) {
            ra = getRandomAkshara();
            var ttRa = (t && tlang[t])
              ? Sanscript.t(String(ra), 'devanagari', tlang[t])
              : Sanscript.t(String(ra), 'devanagari', 'itrans');
            $(cell).html("<span title='" + ttRa + "'>" + ra + "</span>");
          }
        });
      };
      var fullSwaras = ["‡§Ö", "‡§Ü", "‡§á", "‡§à", "‡§â", "‡§ä", "‡§ã", "‡•†", "‡§è", "‡§ê", "‡§ì", "‡§î"];
      var swaras = [
        "\u093e", "\u093f", "\u0940", "\u0941", "\u0942", "\u0943",
        "\u0944", "\u0947", "\u0948", "\u094b", "\u094c",
      ];
      var vyanjanas = [
        "‡§ï", "‡§ñ", "‡§ó", "‡§ò", "‡§ô", "‡§ö", "‡§õ", "‡§ú", "‡§ù", "‡§û", "‡§§", "‡§•", "‡§¶", "‡§ß", "‡§®",
        "‡§ü", "‡§†", "‡§°", "‡§¢", "‡§£", "‡§™", "‡§´", "‡§¨", "‡§≠", "‡§Æ", "‡§Ø", "‡§∞", "‡§≤", "‡§µ",
        "‡§∏", "‡§∂", "‡§∑", "‡§π", "‡§ï‡•ç‡§∑", "‡§ú‡•ç‡§û",
      ];
      var halant = "\u094d";
      var anuswara = "\u0902";
      var visarga = "\u0903";

      var getRandomAkshara = function () {
        //return '-'
        var numLetters = Math.floor(Math.random() * 2) + 1;
        if (numLetters == 1) {
          var rand = Math.floor(
            Math.random() * (fullSwaras.length + vyanjanas.length)
          );
          if (rand >= fullSwaras.length) {
            return vyanjanas[rand - fullSwaras.length];
          }
          return fullSwaras[rand];
        }
        var akshara = "";
        var lettersLeft = numLetters;
        while (lettersLeft > 1) {
          var rand = Math.floor(Math.random() * vyanjanas.length);
          if (akshara.length != 0) {
            akshara = akshara + halant;
          }
          akshara = akshara + vyanjanas[rand];
          lettersLeft = lettersLeft - 1;
        }
        akshara = akshara + swaras[Math.floor(Math.random() * swaras.length)];
        var rand = Math.floor(Math.random() * 10);
        if (rand < 2) {
          akshara = akshara + visarga;
        }
        return akshara;
      };
      var resizeGrid = function () {
        var width = $(window).width();
        var height = $(window).height();
        var minDim = width;
        if (minDim > height) {
          minDim = height;
        }
        $("#grid").width(minDim * 0.85);
        $("#grid").height(minDim * 0.85);
      };
      $(window).resize(resizeGrid);
      //$(document).ready(main);

      initScoreByDifficulty();
      main();
    }

    function sV(obj) {
      obj.href += "&set=" + urlParams.get('set');
      //window.location = window.location.origin + window.location.pathname + "?size=" + size + "&ch=" + chapterSelected + "&v=" + verse_btn.innerText;
    }

    //var t = (Math.random()*100) % data.length;

    function showHint1() {
      $("#lead2").html("");
      for (var i = 0; i < wordList.length; i++) {
        var ttWord = (t && tlang[t])
          ? Sanscript.t(wordList[i], 'devanagari', tlang[t])
          : Sanscript.t(wordList[i], 'devanagari', 'iast');
        $("#lead2").append("<span class=nob title='" + ttWord + "'>" + wordList[i] + " </span>");
      }

    };
    function showHint2() {
      $("#lead2").html("");
      for (var i = 0; i < wordList.length; i++) {
        if (answers.includes(wordList[i]))
          $("#lead2").append("<strong>" + wordList[i] + "</strong> ");
        else
          $("#lead2").append("<span class=nob title='" + ((t && tlang[t])
            ? Sanscript.t(wordList[i], 'devanagari', tlang[t])
            : Sanscript.t(wordList[i], 'devanagari', 'iast')) + "'>" + wordList[i] + " </span>");
      }

    };</script>

    <!-- IMPORTANT: This is your Firestore score file -->
    <script type="module" src="./js/bp26-score.js"></script>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        if (window.bp26Init) {
          window.bp26Init({ game: BP26_GAME, day: BP26_DAY });
        }
      });
    </script>
</body>
</html>
