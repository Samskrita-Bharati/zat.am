<!DOCTYPE HTML>
<html lang="en">

<head>
  <title>‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£‡§Æ‡•ç</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Required libraries for game logic -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@sanskrit-coders/sanscript@1.1.0/sanscript.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <style>
    #svgdiv img {
    }

    img:hover {
      filter: brightness(90%);
      opacity: 0.5;
      x-background:#e2e2e2;
    }

    div {
      border: 1px solid red;
    }

    svg:hover {
      x-width: 11%;
    }

    .st0:hover {
      fill: red;
    }

    .st1:hover {
      fill: yellow;
    }

    .st2:hover {
      fill: blue;
    }

    *[class^="st"]:hover {
      stroke: green;
    }

    img[id$="1"] {
      transform: rotate(10deg);
    }

    img[id$="2"] {
      transform: rotate(20deg);
    }

    img[id$="3"] {
      transform: rotate(30deg);
    }

    img[id$="4"] {
      transform: rotate(40deg);
    }

    img[id$="5"] {
      transform: rotate(50deg);
    }

    img[id$="6"] {
      transform: rotate(60deg);
    }

    img[id$="7"] {
      transform: rotate(70deg);
    }

    img[id$="8"] {
      transform: rotate(80deg);
    }

    img[id$="9"] {
      transform: rotate(90deg);
    }
  </style>

  <!-- ‚úÖ Universal header support -->
  <link rel="stylesheet" href="../styles.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" />
</head>

<body>
  <script type="module" src="../js/bilingual-toggle.js"></script>
  <center>
    <h3>
      Find <span style="position:relative;color:tomato;z-index:99" id="tofind"></span>
      ... ‚ùå = <span id="wt">‡•¶</span>
    </h3>
  </center>

  <div id="svgdiv"></div>
  <p></p>

  <script>
    var secs = 0;

  var tlang = [];
  tlang[1] = "itrans";
  tlang['gu'] = "gujarati";
  tlang['ka'] = "kannada";
  tlang['be'] = "bengali";
  tlang['ml'] = "malayalam";
  tlang['te'] = "telugu";
  tlang['ta'] = "tamil";

  const urlParams = new URLSearchParams(window.location.search);
  var t = urlParams.get('t');
  // Default: no transliteration when `t` is missing.
  // When bili}ngual mode is ON, `t` will be set by the
  // main menu / toggle (e.g., t=gu, t=ka, etc.).
  if (!t)
    t = 0;
  var set = urlParams.get('s');
  if (!set || isNaN(set))
    set = 0;
  var tofind = parseInt((Math.random() * 100) % wpp);
  var wt = 1;

  var chk = function (id) {

    if (id == tofind) {
      document.getElementById(id).style["background"] = "green";
      document.getElementById(id).style["border"] = "1px solid green";
      if (confirm("‡§â‡§§‡•ç‡§§‡§Æ‡§Æ‡•ç !  You found it! \n After " + Sanscript.t(String(wt++), 'iast', 'devanagari') + " attempt(s) \n In " + Sanscript.t(String(secs), 'iast', 'devanagari') + " seconds! \n ‡§™‡•Å‡§®‡§É ?  Press 'ok' to play again"))
        window.location.reload();
    }

    var wpp = 15;
    var tlang = [];
    tlang[1] = "itrans";
    tlang['gu'] = "gujarati";
    tlang['ka'] = "kannada";
    tlang['be'] = "bengali";
    tlang['ml'] = "malayalam";
    tlang['te'] = "telugu";
    tlang['ta'] = "tamil";

    const urlParams = new URLSearchParams(window.location.search);
    var t = urlParams.get('t') || 1;
    var set = parseInt(urlParams.get('s') || 0);
    var tofind = parseInt((Math.random() * 100) % wpp);
    var wt = 1;

    var chk = function (id) {
      if (id == tofind) {
        document.getElementById(id).style.background = "green";
        document.getElementById(id).style.border = "1px solid green";
        if (confirm(
          "‡§â‡§§‡•ç‡§§‡§Æ‡§Æ‡•ç !  You found it!\n After " +
          Sanscript.t(String(wt++), 'iast', 'devanagari') +
          " attempt(s)\n In " +
          Sanscript.t(String(secs), 'iast', 'devanagari') +
          " seconds!\n ‡§™‡•Å‡§®‡§É ? Press OK to play again"
        )) {
          window.location.reload();
        }
      } else {
        document.getElementById(id).style.background = "pink";
        document.getElementById(id).style.border = "1px dotted red";
        $("#wt").html(Sanscript.t(String(wt++), 'itrans', 'devanagari'));
      }
    };

    document.addEventListener('DOMContentLoaded', function () {
      setInterval(() => countSecs("timer"), 1000);
      var lnk = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6CFR_0gDsZl-lmwLFWmtdXMXYGVEHGJ8fvBu2_5wvbEl9L-4Yr0ugI0TFTTdvtLlMTRmLnCIJ5FBF/pub?gid=0&single=true&output=csv";

      Papa.parse(lnk, {
        download: true,
        header: true,
        complete: populateWlist
      });
    });

    function populateWlist(fildat) {
      fullist = fildat.data;
      if (set > fildat.data.length / wpp) set = 0;

      var openmojibase = "https://openmoji.org/data/color/svg/";
      var image = [], words = [], aud = [], imglnk = "";

      for (let i = 0; i < wpp; i++) {
        words.push(fullist[(set * wpp) + i].padam);
        imglnk = fullist[(set * wpp) + i]["Imaage link"];
        imglnk = imglnk.length <= 5 ? openmojibase + imglnk + ".svg" : imglnk;
        image.push(imglnk);
        aud.push(fullist[(set * wpp) + i]["alnk"]);
      }

      $("#tofind").html(
        "<button id=" + tofind +
        " onclick='musicelements[this.id].play()'>üîä</button> " +
        words[tofind]
      );

      if (t != 0 && tlang[t]) {
        $("#tofind").append(" = " + Sanscript.t(words[tofind], 'devanagari', tlang[t]));
      }

      $.each(words, function (i, v) {
        const top = (Math.random() * (window.visualViewport.height - 121)) + 30;
        const right = Math.random() * (window.visualViewport.width - 121);
        const zindex = i;
        const img = '<img id="' + i + '" src="' + image[i] + '" style="top:' + top + 'px; right:' + right + 'px; z-index:' + zindex + ';" width="121" onclick="chk(this.id)">';
        document.getElementById('svgdiv').innerHTML += img + "<audio id=" + i + " src=" + aud[i] + " preload='auto'></audio>";
      });

      musicelements = document.getElementsByTagName("audio");
      musicelements[tofind].play();
    }
  </script>

</body>
</html>
