import{d as w}from"./firebase-config-DVCrEPzz.js";import{c as y,g,u as f,b as h,d as E}from"./auth-api-DyZ-SOpA.js";import{doc as L,updateDoc as I}from"https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";const m=document.getElementById("profile-name"),B=document.getElementById("profile-email"),l=document.getElementById("display-role"),i=document.getElementById("display-date"),b=document.getElementById("edit-name-form"),u=document.getElementById("new-name"),s=document.getElementById("name-message"),v=document.getElementById("logout-btn"),d=document.getElementById("change-password-form"),t=document.getElementById("password-message"),M=document.getElementById("password-card");let c=null;y().then(async n=>{c=n;const e=await g();if(m.textContent=e.name||"User",B.textContent=n.email,e.isAdmin?l.textContent="Admin":l.textContent="User",e.createdAt){const a=e.createdAt.toDate(),r={year:"numeric",month:"long",day:"numeric"};i.textContent=a.toLocaleDateString("en-US",r)}else i.textContent="Not available";if(u.value=e.name||"",n.providerData.some(a=>a.providerId==="google.com")){M.classList.add("disabled"),d.querySelectorAll("input").forEach(p=>p.disabled=!0);const r=d.querySelector("button");r.disabled=!0}}).catch(()=>{window.location.href="login.html"});b.addEventListener("submit",async n=>{n.preventDefault();const e=u.value.trim();if(!e){s.innerHTML="Name cannot be empty!",s.style.color="red";return}try{await f(c,{displayName:e});const o=L(w,"users",c.uid);await I(o,{name:e}),m.textContent=e,s.innerHTML="Name updated successfully!",s.style.color="green",setTimeout(()=>{s.innerHTML=""},3e3)}catch(o){console.error(o),s.innerHTML="Failed to update name. Please try again.",s.style.color="red"}});d.addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("current-password").value,o=document.getElementById("new-password").value,a=document.getElementById("confirm-new-password").value;if(o!==a){t.innerHTML="New passwords do not match!",t.style.color="red";return}if(o.length<8){t.innerHTML="New password must be at least 8 characters.",t.style.color="red";return}if(e===o){t.innerHTML="New password must be different from current password.",t.style.color="red";return}try{await h(e,o),t.innerHTML="Password changed successfully!",t.style.color="green",d.reset(),setTimeout(()=>{t.innerHTML=""},3e3)}catch(r){console.error(r),r.code==="auth/wrong-password"||r.code==="auth/invalid-credential"?t.innerHTML="Current password is incorrect.":r.code==="auth/weak-password"?t.innerHTML="New password is too weak.":t.innerHTML="Failed to change password. Please try again.",t.style.color="red"}});v.addEventListener("click",async()=>{try{await E(),window.location.href="login.html"}catch(n){console.error(n)}});
