import{d as p,b as y,u as g}from"./firebase-config-BpSi-wPl.js";import{c as f,g as h,u as E,b as L,d as I}from"./auth-api-B38Ftrpm.js";const m=document.getElementById("profile-name"),b=document.getElementById("profile-email"),l=document.getElementById("display-role"),i=document.getElementById("display-date"),B=document.getElementById("edit-name-form"),u=document.getElementById("new-name"),s=document.getElementById("name-message"),v=document.getElementById("logout-btn"),d=document.getElementById("change-password-form"),t=document.getElementById("password-message"),M=document.getElementById("password-card");let c=null;f().then(async n=>{c=n;const e=await h();if(m.textContent=e.name||"User",b.textContent=n.email,e.isAdmin?l.textContent="Admin":l.textContent="User",e.createdAt){const a=e.createdAt.toDate(),r={year:"numeric",month:"long",day:"numeric"};i.textContent=a.toLocaleDateString("en-US",r)}else i.textContent="Not available";if(u.value=e.name||"",n.providerData.some(a=>a.providerId==="google.com")){M.classList.add("disabled"),d.querySelectorAll("input").forEach(w=>w.disabled=!0);const r=d.querySelector("button");r.disabled=!0}}).catch(()=>{window.location.href="login.html"});B.addEventListener("submit",async n=>{n.preventDefault();const e=u.value.trim();if(!e){s.innerHTML="Name cannot be empty!",s.style.color="red";return}try{await E(c,{displayName:e});const o=p(y,"users",c.uid);await g(o,{name:e}),m.textContent=e,s.innerHTML="Name updated successfully!",s.style.color="green",setTimeout(()=>{s.innerHTML=""},3e3)}catch(o){console.error(o),s.innerHTML="Failed to update name. Please try again.",s.style.color="red"}});d.addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("current-password").value,o=document.getElementById("new-password").value,a=document.getElementById("confirm-new-password").value;if(o!==a){t.innerHTML="New passwords do not match!",t.style.color="red";return}if(o.length<8){t.innerHTML="New password must be at least 8 characters.",t.style.color="red";return}if(e===o){t.innerHTML="New password must be different from current password.",t.style.color="red";return}try{await L(e,o),t.innerHTML="Password changed successfully!",t.style.color="green",d.reset(),setTimeout(()=>{t.innerHTML=""},3e3)}catch(r){console.error(r),r.code==="auth/wrong-password"||r.code==="auth/invalid-credential"?t.innerHTML="Current password is incorrect.":r.code==="auth/weak-password"?t.innerHTML="New password is too weak.":t.innerHTML="Failed to change password. Please try again.",t.style.color="red"}});v.addEventListener("click",async()=>{try{await I(),window.location.href="login.html"}catch(n){console.error(n)}});
